// parameters --
// number of pingers: __NBPINGERS__
// number of balls: __NBBALLS__
// delay: __DELAY__

ended(0).
terminated(0).
t_total(__NBBALLS__).
m_total(__NBPINGERS__).

!init.

+!init : t_total(T) <-
    Time = system.time;
    .print("start at: ", Time);
    for ( .range(I,1,T) ) {
        W = math.random(__DELAY__);
        .send(ponger, achieve, pong(W));
    }.

@lm[atomic]
+!finished : ended(I) & t_total(T) & T > I + 1 <-
    -+ended(I+1).

+!finished <-
    .send("pinger1", achieve, terminate).

@lm2[atomic]
+!terminate : terminated(I) & m_total(M) & M > I + 1 <-
    -+terminated(I+1).

+!terminate <-
    Time = system.time;
    .print("done at: ", Time);
    .stopMAS.
